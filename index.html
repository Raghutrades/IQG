<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Intraday Quick Grabber</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <!-- Added CDNs for export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @font-face {
            font-family: 'Quenton';
            src: url('quenton.otf') format('opentype');
        }

        :root {
            --dark-bg: #121420;
            --dark-card: #1a1d2e;
            --dark-text: #e0e3ff;
            --dark-border: #2a3042;
            --dark-accent: #4361ee;
            --dark-glow: rgba(67, 97, 238, 0.3);
            
            --light-bg: #f8fafc;
            --light-card: #ffffff;
            --light-text: #1e293b;
            --light-border: #e2e8f0;
            --light-accent: #3b82f6;
            --light-glow: rgba(59, 130, 246, 0.2);
            
            --gold-primary: #FFD700;
            --gold-secondary: #FFC300;
            --profit-green: #10B981;
            --loss-red: #EF4444;
            --active-green: #4CAF50;
            --inactive-red: #F44336;
            
            --bg: var(--dark-bg);
            --card: var(--dark-card);
            --text: var(--dark-text);
            --border: var(--dark-border);
            --accent: var(--dark-accent);
            --glow: var(--dark-glow);
        }
        
        .light-mode {
            --bg: var(--light-bg);
            --card: var(--light-card);
            --text: var(--light-text);
            --border: var(--light-border);
            --accent: var(--light-accent);
            --glow: var(--light-glow);
            --gold-primary: #d4af37;
            --profit-green: #059669;
            --loss-red: #DC2626;
        }
        
        .light-mode .main-title {
            color: #3b82f6 !important;
        }
        
        .light-mode .tagline {
            color: #000 !important;
        }
        
        .light-mode .datetime-label {
            color: #3b82f6 !important;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
        }
        
        /* === MINIMAL NAV === */
.minimal-nav {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.5rem 0;
  background: var(--card);
  border-bottom: 1px solid var(--border);
}
.minimal-nav-btn {
  background: none;
  border: none;
  color: var(--text);
  opacity: 0.7;
  font-size: 0.9rem;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
}
.minimal-nav-btn.active {
  opacity: 1;
  font-weight: 600;
  color: var(--gold-primary);
}


        /* === HEADER STYLES === */
        .header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 1rem 2rem;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4361ee, #3a0ca3, #7209b7);
            filter: blur(4px);
        }
        
        .datetime-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .datetime-item {
            display: flex;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .datetime-label {
            font-weight: 600;
            color: var(--gold-secondary);
        }
        
        .title-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
            object-fit: contain;
            background: rgba(255,255,255,0.05);
            z-index: 2;
            animation: 
                logo-pulse-green 2s infinite alternate,
                logo-bounce 0.8s ease-in-out;
            transform-origin: center;
        }

        @keyframes logo-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.9); }
        }

        @keyframes logo-pulse-green {
            0% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.6); }
            100% { box-shadow: 0 0 30px rgba(76, 175, 80, 0.8); }
        }
        
        .main-title {
            font-family: 'Quenton', sans-serif;
            font-size: 2.5rem;
            color: white;
            margin: 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
            animation: title-glow 2s infinite alternate;
        }
        
        @keyframes title-glow {
            0% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
            100% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.6); }
        }
        
        .tagline {
            font-family: system-ui, sans-serif;
            font-size: 1.1rem;
            color: var(--gold-primary);
            margin-top: 0.5rem;
            text-align: center;
            font-weight: 500;
        }

        /* Search Bar Styles */
        .search-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            font-size: 1rem;
        }

        .search-results {
            position: absolute;
            width: calc(100% - 4rem);
            max-height: 300px;
            overflow-y: auto;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 5px;
            z-index: 100;
            display: none;
        }

        .search-result-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
        }

        .search-result-item:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        /* === SECTOR GRID === */
        .sector-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
            padding: 2rem;
        }
        
        .sector-table {
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            height: 420px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .sector-table:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 40px var(--glow);
        }
        
        .sector-header {
            background: linear-gradient(135deg, var(--accent), #3a0ca3);
            color: white;
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            font-size: 1.1rem;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        /* Sector numbers */
        .sector-number {
            color: var(--gold-primary);
            margin-right: 8px;
            font-weight: bold;
        }
        
        .stock-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            position: relative;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
        }
        
        .stock-list::-webkit-scrollbar {
            display: none;
        }
        
        .stock-page {
            display: none;
            height: 100%;
        }
        
        .stock-page.active {
            display: flex;
            flex-direction: column;
        }
        
        .stock-item {
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .stock-item:hover {
            background: rgba(67, 97, 238, 0.1);
            cursor: pointer;
            transform: translateX(5px);
        }
        
        .stock-item::after {
            content: '‚Üí';
            color: var(--gold-primary);
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .stock-item:hover::after {
            opacity: 1;
        }
        
        /* === NEW PAGINATION STYLES === */
        .mini-pagination {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
            z-index: 2;
            transition: all 0.3s ease;
            max-height: 24px;
            overflow: hidden;
        }
        
        .mini-pagination:hover {
            max-height: 200px;
        }
        
        .mini-pagination-container {
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .mini-page-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            cursor: pointer;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin: 2px 0;
        }
        
        .mini-page-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .mini-page-btn.active {
            background: var(--accent);
            color: white;
        }
        
        .current-page-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .mini-pagination:hover .current-page-indicator {
            opacity: 1;
        }
        
        /* === 3D QUOTE BOX === */
        .quote-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: linear-gradient(145deg, var(--card), #232a3a);
            border-radius: 12px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 0 20px rgba(0, 0, 0, 0.3);
            transform: perspective(500px) rotateX(10deg);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { 
                transform: perspective(500px) rotateX(10deg) translateY(0);
            }
            50% { 
                transform: perspective(500px) rotateX(12deg) translateY(-10px);
            }
        }
        
        .quote-container:hover {
            animation: none;
            transform: perspective(500px) rotateX(12deg) translateY(-5px);
        }
        
        .quote-text {
            font-size: 1.25rem;
            line-height: 1.6;
            font-style: italic;
            position: relative;
            z-index: 2;
            margin: 0;
            text-align: center;
        }
        
        .quote-author {
            display: block;
            margin-top: 1rem;
            text-align: right;
            font-weight: 600;
            color: var(--gold-primary);
        }
        
        /* === ENHANCED TRADING CALCULATOR === */
        .calculator-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .calculator-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--gold-primary);
            font-size: 1.5rem;
        }
        
        .calculator-mode-selector {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
        }
        
        .calculator-mode-selector label {
            font-weight: 600;
            margin-right: 10px;
            color: var(--accent);
        }
        
        .calculator-mode-selector select {
            padding: 0.5rem;
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        /* Calculator Table Styling */
.trades-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  background: var(--card);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.trades-table th {
  background: linear-gradient(135deg, var(--accent), #3a0ca3);
  color: white;
  padding: 12px 10px;
  text-align: left;
  font-weight: 600;
}

.trades-table td {
  padding: 10px;
  border-bottom: 1px solid var(--border);
}

.trades-table tr:last-child td {
  border-bottom: none;
}

/* Column Widths */
.trades-table th:nth-child(1), 
.trades-table td:nth-child(1) { width: 8%; }  /* Trade # */
.trades-table th:nth-child(2), 
.trades-table td:nth-child(2) { width: 20%; } /* Scrip */
.trades-table th:nth-child(3), 
.trades-table td:nth-child(3) { width: 22%; } /* Buy */
.trades-table th:nth-child(4), 
.trades-table td:nth-child(4) { width: 22%; } /* Sell */
.trades-table th:nth-child(5), 
.trades-table td:nth-child(5) { width: 15%; } /* Qty */

/* Input Styling */
.trade-input {
  width: 100%;
  padding: 8px;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: var(--bg);
  color: var(--text);
  font-size: 13px;
}

.trade-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--glow);
}

        
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        .calculator-section {
            margin-bottom: 1.5rem;
        }
        
        .calculator-section-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--accent);
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .calculator-section-title::after {
            content: '‚ñº';
            font-size: 0.8rem;
            transition: transform 0.3s;
        }
        
        .calculator-section-title.collapsed::after {
            transform: rotate(-90deg);
        }
        
        .calculator-section-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .calculator-section-content.collapsed {
            max-height: 0 !important;
            opacity: 0;
        }
        
        .calculator-input-group {
            margin-bottom: 1rem;
            position: relative;
        }
        
        .calculator-label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .calculator-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        
        textarea.calculator-input {
            min-height: 80px;
            resize: vertical;
        }
        
        .char-counter {
            position: absolute;
            right: 10px;
            bottom: 10px;
            font-size: 0.8rem;
            color: var(--text);
            opacity: 0.7;
        }
        
        .calculator-select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        
        .calculator-button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 1rem;
        }
        
        .calculator-button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .calculator-button.secondary {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            margin-top: 0.5rem;
        }
        
        .calculator-results {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 6px;
            border-left: 4px solid var(--accent);
        }
        
        .calculator-result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .calculator-result-label {
            font-weight: 600;
        }
        
        .summary-card {
            background: var(--card);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 0 20px var(--glow);
        }
        
        .summary-card h3 {
            margin-top: 0;
            color: var(--gold-primary);
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }
        
        .profit {
            color: var(--profit-green);
            font-weight: bold;
        }
        
        .loss {
            color: var(--loss-red);
            font-weight: bold;
        }
        
        .export-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        /* === FOOTER === */
        .footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .footer a {
            color: var(--accent);
            text-decoration: none;
        }
        
        /* === THEME TOGGLE === */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 0.75rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            color: var(--text);
        }
        
        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px var(--glow);
        }
        
        .theme-icon {
            font-size: 1.25rem;
        }
        
        /* === RANDOM TICKER BOX === */
        .random-ticker-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(67, 97, 238, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .random-ticker-label {
            font-size: 0.8rem;
            color: var(--gold-primary);
            margin-bottom: 4px;
        }
        
        .random-ticker-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .random-ticker-value:hover {
            color: var(--accent);
            transform: scale(1.05);
        }

        /* ===== ADD THIS NEW CSS ===== */
    #randomTicker {
        transition: opacity 0.3s ease;
        display: inline-block;
        min-width: 120px;
        text-align: center;
    }


        /* Random Ticker Animation */
@keyframes shuffle {
    0% { opacity: 0.5; transform: translateY(5px); }
    100% { opacity: 1; transform: translateY(0); }
}
.random-ticker-value.shuffle {
    animation: shuffle 0.5s ease;
}

        

        /* === TICKER TAPE === */
        .ticker-tape-container {
            width: 100%;
            padding: 0.5rem 0;
            background: var(--dark-card);
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .tradingview-widget-container {
            height: auto !important;
        }

                 
        /* === SCAN MODE BUTTON (NEW DESIGN) === */
        .scan-mode-toggle {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 0.75rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text);
        }

        .scan-mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--glow);
        }

        .scan-mode-toggle.active {
            background: linear-gradient(135deg, var(--active-green), #2E7D32);
            color: white;
        }

        .scan-mode-toggle.active .scan-icon {
            filter: brightness(1.5);
        }

        /* Watchlist Styles */
        .watchlist-panel {
            position: fixed;
            top: 150px;
            right: 20px;
            width: 300px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 0 15px var(--glow);
            z-index: 90;
            cursor: grab;
            transition: all 0.3s ease;
            animation: glow-pulse 3s infinite;
        }

        @keyframes glow-pulse {
            0% { box-shadow: 0 0 10px var(--glow); }
            50% { box-shadow: 0 0 20px var(--accent); }
            100% { box-shadow: 0 0 10px var(--glow); }
        }

        .watchlist-panel:active {
            cursor: grabbing;
            transform: scale(1.02);
        }

        .watchlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
        }

        .close-watchlist {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--loss-red);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .clear-all-btn {
            background: var(--loss-red);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .clear-all-btn:hover {
            background: var(--inactive-red);
            transform: scale(1.05);
        }
        
        .watchlist-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .watchlist-table th {
            text-align: left;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        
        .watchlist-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        
        .watchlist-table tr:last-child td {
            border-bottom: none;
        }
        
        .watchlist-table tr:hover {
            background: rgba(67, 97, 238, 0.05);
        }
        
        .remove-watchlist {
            color: var(--loss-red);
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            padding: 0 8px;
        }
        
        .remove-watchlist:hover {
            transform: scale(1.2);
        }
        
        /* TradingView Widget Container */
        .tradingview-widget-container {
            width: 100%;
            height: 100%;
        }
        
       /* Widgets Container */
.widgets-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  width: 100%;
  height: 100vh; /* Optional: Set a shared height for both widgets */
}

/* Base widget style */
.widget {
  flex: 1 1 45%; /* Default fallback */
  min-width: 300px;
  height: 100%; /* Ensure widgets fill container height */
}

/* Sector widget - 40% width */
.sector-widget {
  flex: 0 0 40%;
  height: 100%;
}

/* Heatmap widget - 60% width */
.heatmap-widget {
  flex: 0 0 60%;
  height: 100%;
}

/* Responsive: stack vertically on small screens */
@media (max-width: 768px) {
  .widget,
  .sector-widget,
  .heatmap-widget {
    flex: 0 0 100%;
  }
}

/* Ensure embedded TradingView containers fill the widget area */
.tradingview-widget-container {
  height: 100% !important;
  width: 100% !important;
}



        /* === RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 1600px) {
            .sector-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 1200px) {
            .sector-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .calculator-grid {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 900px) {
            .sector-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header {
                grid-template-columns: 1fr;
                gap: 1rem;
                text-align: center;
            }
            
            .datetime-container {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .logo-container {
                justify-content: center;
            }
            
            .random-ticker-box {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
            }

            .watchlist-panel {
                width: 250px;
            }
        }
        
        @media (max-width: 600px) {
            .sector-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
                gap: 1rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .logo {
                width: 50px;
                height: 50px;
            }
            
            .trades-table {
                font-size: 0.8rem;
            }
            
            .trades-table th, 
            .trades-table td {
                padding: 0.5rem;
            }
            
            .random-ticker-box {
                position: static;
                margin: 10px auto;
                width: fit-content;
            }

            .watchlist-panel {
                width: 90%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                right: unset;
            }

            .theme-toggle, 
            .scan-mode-toggle {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                bottom: 1rem;
            }

            .scan-mode-toggle {
                bottom: 4rem;
            }

            .calculator-container {
                padding: 1rem;
            }

            .calculator-button {
                padding: 0.5rem 1rem;
            }

            .search-container {
                padding: 0.5rem 1rem;
            }

            .search-input {
                padding: 8px;
            }
        }

        /* Mobile touch improvements */
        @media (hover: none) {
            .stock-item:hover {
                transform: none;
                background: none;
            }
            
            .stock-item:hover::after {
                opacity: 0;
            }
            
            .mini-pagination:hover {
                max-height: 24px;
            }
            
            .mini-pagination .current-page-indicator {
                opacity: 1;
            }
        }

        /* ===== Trade Calculator Table Fixes ===== */
.trades-table {
  table-layout: fixed; /* Makes columns respect width settings */
  width: 100%; /* Ensures table uses full container width */
}
.trades-table th, 
.trades-table td {
  padding: 10px; /* Adds consistent spacing */
  word-wrap: break-word; /* Prevents text overflow */
  text-align: left; /* Aligns content to left */
}
.trades-table th:nth-child(1) { width: 8%; }   /* Trade # column */
.trades-table th:nth-child(2) { width: 20%; }  /* Ticker column */
.trades-table th:nth-child(3), 
.trades-table th:nth-child(4) { width: 25%; }  /* Buy/Sell Price columns */
.trades-table th:nth-child(5) { width: 15%; }  /* Quantity column */
    
    /* ===== AUTOCOMPLETE DROPDOWN ===== */
.autocomplete-dropdown {
  position: absolute;
  top: 100%; /* Positions below input */
  left: 0;
  width: 100%;
  max-height: 200px;
  overflow-y: auto;
  background: var(--card);
  border: 1px solid var(--border);
  border-top: none;
  border-radius: 0 0 8px 8px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  display: none; /* Hidden by default */
}

.autocomplete-item {
  padding: 8px 12px;
  cursor: pointer;
  font-size: 14px;
}

.autocomplete-item:hover {
  background: rgba(67, 97, 238, 0.1);
}

/* Mobile responsiveness */
@media (max-width: 600px) {
  .autocomplete-dropdown {
    max-height: 150px;
  }
}


    </style>
</head>
<body>
    <!-- Header with Date/Time, Title, and Ticker -->
    <header class="header">
        <div class="datetime-container">
            <div class="datetime-item">
                <span class="datetime-label">Date:</span>
                <span id="current-date">Loading...</span>
            </div>
            <div class="datetime-item">
                <span class="datetime-label">Time:</span>
                <span id="current-time">Loading...</span>
            </div>
            <div class="datetime-item">
                <span class="datetime-label">Remaining in Month:</span>
                <span id="days-month">Loading...</span>
            </div>
            <div class="datetime-item">
                <span class="datetime-label">Remaining in Year:</span>
                <span id="days-year">Loading...</span>
            </div>
        </div>
        
        <div class="title-container">
            <div class="logo-container">
                <img src="logo.png" class="logo" alt="Intraday Quick Grabber Logo">
                <div>
                    <h1 class="main-title">Intraday Quick Grabber</h1>
                    <div class="tagline" id="tagline">Catch the Pulse, Ride the Move.</div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Minimal Nav Bar -->
<nav class="minimal-nav">
  <button class="minimal-nav-btn active" data-page="market">MARKET</button>
  <button class="minimal-nav-btn" data-page="home">HOME</button>
  <button class="minimal-nav-btn" data-page="tools">TOOLS</button>
</nav>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" id="tickerSearch" placeholder="Search ticker" class="search-input">
        <div id="searchResults" class="search-results"></div>
    </div>
    
    <!-- Ticker Tape Widget -->
    <div class="ticker-tape-container">
        <!-- TradingView Widget BEGIN -->
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright">
                <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                
                </a>
            </div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
            {
                "symbols": [
                    { "description": "Sensex", "proName": "BSE:SENSEX" },
                    { "description": "Bankex", "proName": "BSE:BANK" },
                    { "description": "BSE IT", "proName": "BSE:FOCIT" },
                    { "description": "Reliance", "proName": "BSE:RELIANCE" },
                    { "description": "HDFC Bank", "proName": "BSE:HDFCBANK" },
                    { "description": "ICICI Bank", "proName": "BSE:ICICIBANK" },
                    { "description": "Infosys", "proName": "BSE:INFY" },
                    { "description": "L&T", "proName": "BSE:LT" },
                    { "description": "TCS", "proName": "BSE:TCS" },
                    { "description": "SBI", "proName": "BSE:SBIN" },
                    { "description": "ITC", "proName": "BSE:ITC" },
                    { "description": "Airtel", "proName": "BSE:BHARTIARTL" },
                    { "description": "Axis Bank", "proName": "BSE:AXISBANK" }
                ],
                "showSymbolLogo": true,
                "isTransparent": false,
                "displayMode": "adaptive",
                "colorTheme": "dark",
                "locale": "en"
            }
            </script>
        </div>
<!-- TradingView Widget END -->
    </div>


    <!-- ===== START: ADDED WIDGETS ===== -->
<div class="widgets-container" style="margin: 2rem 0; height: 50vh;">
  <!-- Sector Widget -->
  <div class="widget">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
      {
        "width": "100%",
        "height": "100%",
        "symbolsGroups": [
          {
            "name": "BSE Sector Indices",
            "originalName": "BSE Sector Indices",
            "symbols": [
              { "name": "BSE:FOCIT", "displayName": "IT" },
              { "name": "BSE:BANK", "displayName": "BANKS" },
              { "name": "BSE:FINSER", "displayName": "Financial Services" },
              { "name": "BSE:ENERGY", "displayName": "Energy" },
              { "name": "BSE:OILGAS", "displayName": "OIL & GAS" },
              { "name": "BSE:FMCG", "displayName": "Fast Moving Consumer Goods" },
              { "name": "BSE:HC", "displayName": "Healthcare" },
              { "name": "BSE:AUTO", "displayName": "AUTO" },
              { "name": "BSE:CG", "displayName": "CAPITAL GOODS" },
              { "name": "BSE:CD", "displayName": "CONSUMER DURABLES" },
              { "name": "BSE:METAL", "displayName": "METAL" },
              { "name": "BSE:POWER", "displayName": "POWER" },
              { "name": "BSE:INDSTR", "displayName": "Industrials" },
              { "name": "BSE:TELCOM", "displayName": "Telecommunication" },
              { "name": "BSE:REALTY", "displayName": "REALTY" },
              { "name": "BSE:UTILS", "displayName": "Utilities" }
            ]
          }
        ],
        "showSymbolLogo": false,
        "isTransparent": false,
        "colorTheme": "dark",
        "locale": "en",
        "backgroundColor": "#131722"
      }
      </script>
    </div>
  </div>

  <!-- Heatmap Widget -->
  <div class="widget">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js" async>
      {
        "exchanges": [],
        "dataSource": "SENSEX",
        "grouping": "sector",
        "blockSize": "market_cap_basic",
        "blockColor": "change",
        "locale": "en",
        "symbolUrl": "",
        "colorTheme": "dark",
        "hasTopBar": true,
        "isDataSetEnabled": true,
        "isZoomEnabled": true,
        "hasSymbolTooltip": true,
        "isMonoSize": false,
        "width": "100%",
        "height": "100%"
      }
      </script>
    </div>
  </div>
</div>
<!-- ===== END: ADDED WIDGETS ===== -->


        

    <div id="market-page" class="page active">

    <!-- Random Ticker Box -->
    <div class="random-ticker-box">
        
        <div class="random-ticker-label">Random Ticker</div>
        <div class="random-ticker-value" id="randomTicker">Loading...</div>
    </div>
    
    <!-- Watchlist Panel -->
    <div class="watchlist-panel" id="watchlistPanel" title="Drag to move | Ctrl+Shift+Z to toggle">
        <button class="close-watchlist" id="closeWatchlist" title="Close Watchlist">√ó</button>
        <div class="watchlist-header">
            <h3>‚≠ê Your Watchlist</h3>
            <button class="clear-all-btn" id="clearWatchlist" title="Clear All (Ctrl+Shift+Del)">
                ‚úï Clear All
            </button>
        </div>
        <table class="watchlist-table" id="watchlistTable">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Sector</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="watchlistBody"></tbody>
        </table>
    </div>
    


    <!-- Sector Grid -->
    <div class="sector-grid" id="sectorGrid">
        <!-- Sectors will be inserted here by JavaScript -->
    </div>
    
        


    <!-- Enhanced Trading Calculator -->
    <div class="calculator-container">
        <h2 class="calculator-title">Advanced Trading Calculator</h2>
        
        <!-- Trade Multiplier Selector -->
        <div class="calculator-mode-selector">
            <label>Calculation Mode:</label>
            <select id="tradeMultiplier">
                <option value="1">Single Trade</option>
                <option value="5">5 Trades</option>
                <option value="10">10 Trades</option>
                <option value="20">20 Trades</option>
            </select>
        </div>
        
        <!-- Dynamic Trades Table -->
        <table class="trades-table" id="tradesTable">
            <thead>
  <tr>
    <th>Trade</th>
    <th>Scrip</th>
    <th>Buy Price (‚Çπ)</th>
    <th>Sell Price (‚Çπ)</th>
    <th>Quantity</th>
  </tr>
</thead>
            <tbody id="tradesTableBody">
                <!-- Rows will be inserted here by JavaScript -->
            </tbody>
        </table>
        
        <div class="calculator-grid">
            <!-- Trade Type Section -->
            <div class="calculator-section">
                <h3 class="calculator-section-title">Trade Configuration</h3>
                <div class="calculator-section-content">
                    <div class="calculator-input-group">
                        <label class="calculator-label">Trade Type</label>
                        <select class="calculator-select" id="tradeType">
                            <option value="equity_delivery">Equity Delivery</option>
                            <option value="equity_intraday">Equity Intraday</option>
                            <option value="futures">Futures</option>
                            <option value="options">Options</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Brokerage Section (Collapsible) -->
            <div class="calculator-section">
                <h3 class="calculator-section-title collapsed">Brokerage Charges</h3>
                <div class="calculator-section-content collapsed">
                    <div class="calculator-input-group">
                        <label class="calculator-label">Equity Delivery</label>
                        <input type="text" class="calculator-input" id="equityDelivery" value="‚Çπ0 (Zero Brokerage)" readonly>
                    </div>
                    <div class="calculator-input-group">
                        <label class="calculator-label">Equity Intraday</label>
                        <input type="text" class="calculator-input" id="equityIntraday" value="0.03% or ‚Çπ20 per order (lower)" readonly>
                    </div>
                    <div class="calculator-input-group">
                        <label class="calculator-label">Futures</label>
                        <input type="text" class="calculator-input" id="futures" value="0.03% or ‚Çπ20 per order (lower)" readonly>
                    </div>
                    <div class="calculator-input-group">
                        <label class="calculator-label">Options</label>
                        <input type="text" class="calculator-input" id="options" value="Flat ‚Çπ20 per order" readonly>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NEW: Trade Notes Section -->
        <div class="calculator-section">
            <h3 class="calculator-section-title">Trade Notes</h3>
            <div class="calculator-section-content">
                <div class="calculator-input-group">
                    <label class="calculator-label">Entry Reason (Max 300 chars)</label>
                    <textarea class="calculator-input" id="entryReason" maxlength="300" 
                              placeholder="Why are you entering this trade?"></textarea>
                    <div class="char-counter"><span id="entryChars">0</span>/300</div>
                </div>
                <div class="calculator-input-group">
                    <label class="calculator-label">Exit Reason (Max 300 chars)</label>
                    <textarea class="calculator-input" id="exitReason" maxlength="300"
                              placeholder="Why did you exit this trade?"></textarea>
                    <div class="char-counter"><span id="exitChars">0</span>/300</div>
                </div>
                <div class="calculator-input-group">
                    <label class="calculator-label">Lessons Learned (Max 300 chars)</label>
                    <textarea class="calculator-input" id="lessonsLearned" maxlength="300"
                              placeholder="What did you learn from this trade?"></textarea>
                    <div class="char-counter"><span id="lessonsChars">0</span>/300</div>
                </div>
            </div>
        </div>
        
        <button class="calculator-button" id="calculateButton">Calculate All Trades</button>
        
        <!-- NEW: Export Buttons -->
        <div class="export-buttons">
    <button class="calculator-button secondary" onclick="exportAsText(getTradeData())">
        üìù Export as Text
    </button>
    <button class="calculator-button secondary" onclick="exportAsPDF(getTradeData())">
        üìÑ Export as PDF
    </button>
    <button class="calculator-button secondary" onclick="exportAsExcel(getTradeData())">
        üìä Export as Excel
    </button>
</div>
        
        <!-- Results Section -->
        <div class="calculator-results" id="calculatorResults" style="display: none;">
            <div class="summary-card">
                <h3>Summary Results</h3>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total Gross Profit/Loss:</span>
                    <span id="grossResult">‚Çπ0.00</span>
                </div>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total Net Profit/Loss:</span>
                    <span id="netResult" style="font-weight: bold;">‚Çπ0.00</span>
                </div>
            </div>
            
            <button class="calculator-button secondary" id="toggleDetails">Show Detailed Breakdown ‚ñº</button>
            
            <div id="detailedResults" style="display: none; margin-top: 1rem;">
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total Brokerage:</span>
                    <span id="brokerageResult">‚Çπ0.00</span>
                </div>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total STT/CTT:</span>
                    <span id="sttResult">‚Çπ0.00</span>
                </div>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total Transaction Charges:</span>
                    <span id="transactionResult">‚Çπ0.00</span>
                </div>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total GST:</span>
                    <span id="gstResult">‚Çπ0.00</span>
                </div>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total Stamp Duty:</span>
                    <span id="stampResult">‚Çπ0.00</span>
                </div>
                <div class="calculator-result-item">
                    <span class="calculator-result-label">Total SEBI Charges:</span>
                    <span id="sebiResult">‚Çπ0.00</span>
                </div>
            </div>
        </div>
    </div>
    
    </div> <!-- Close market-page -->
<div id="home-page" class="page"></div>
<div id="tools-page" class="page"></div>

    <!-- Quote Container -->
    <div class="quote-container">
        <p class="quote-text" id="quoteText">"The market is a device for transferring money from the impatient to the patient."</p>
        <span class="quote-author" id="quoteAuthor">- Warren Buffett</span>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        Designed by <a href="https://www.instagram.com/nerdyintruder/" target="_blank">@Nerdyintruder</a>
    </div>
    
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle">
        <span class="theme-icon" id="themeIcon">üåô</span>
        <span id="themeText">Dark Mode</span>
    </button>

    <!-- Scan Mode Toggle -->
    <button class="scan-mode-toggle" id="scanModeToggle" title="Scan Mode (Ctrl+Shift+S)">
        <span class="scan-icon">üîç</span>
        <span>Scan Mode</span>
    </button>

    <script>
        // Stock data for all 15 sectors
        const sectorData = {
            "NIFTY50": ["TRENT", "TCS", "NTPC", "BRITANNIA", "ICICIBANK", "ITC", "HINDUNILVR", "BHARTIARTL", "ADANIPORTS", "TECHM", "COALINDIA", "RELIANCE", "ONGC", "INFY", "NESTLEIND", "SBIN", "ASIANPAINT", "ADANIENT", "KOTAKBANK", "BPCL", "WIPRO", "MARUTI", "HCLTECH", "BAJFINANCE", "TATAMOTORS", "LT", "BEL", "HEROMOTOCO", "HDFCLIFE", "TITAN", "DRREDDY", "TATASTEEL", "CIPLA", "TATACONSUM", "POWERGRID", "JSWSTEEL", "BAJAJFINSV", "GRASIM", "APOLLOHOSP", "HINDALCO", "ULTRACEMCO", "BAJAJ-AUTO", "INDUSINDBK", "SBILIFE", "SHRIRANFIN", "HDFCBANK", "SUNPHARMA", "M&M", "EICHERMOT", "AXISBANK"],
            "BANKING": ["ICICIBANK", "BANKBARODA", "SBIN", "KOTAKBANK", "FEDERALBNK", "INDIANB", "BANKINDIA", "INDUSINBK", "AUBANK", "HDFCBANK", "PNB", "IDFCFIRSTB", "CANBK", "AXISBANK"],
            "AUTOMOBILE": ["EXIDEIND", "MOTHERSON", "APOLLOTYRE", "MARUTI", "TATAMOTORS", "BOSCHLTD", "HEROMOTOCO", "BALKRISIND", "TVSMOTOR", "SONACOMS", "TITAGARH", "TIINDIA", "BHARATFORG", "MRF", "BAJAJ-AUTO", "M&M", "EICHERMOT"],
            "FINANCIAL SERVICES": ["ICICIBANK", "IRFC", "ICICIGI", "PFC", "ICICIPRULI", "SBICARD", "MUTHOOTFIN", "SBIN", "LICHSGFIN", "KOTAKBANK", "BAJFINANCE", "HDFCAMC", "POONAWALLA", "LICI", "HDFCLIFE", "HUDCO", "RECLTD", "CDSL", "JIOFIN", "BAJAJFINSV", "CHOLAFIN", "IIFL", "POLICYBZR", "MAXHEALTH", "SBILIFE", "SHRIRAMFIN", "ANGELONE", "BSE", "HDFCBANK", "PAYTM", "AXISBANK"],
            "FMCG": ["BRITANNIA", "ITC", "HINDUNILVR", "DMART", "NESTLEIND", "COLPAL", "DABUR", "MARICO", "KALYANJIL", "ZOMATO", "VBL", "TATACONSUM", "PATANJALI", "UNITDSPR", "GODREJCP", "NYKAA", "SUPERMEIND"],
            "INFORMATION TECHNOLOGY": ["TCS", "TECHM", "INFY", "WIPRO", "HCLTECH", "PERSISTENT", "COFORGE", "CAMS", "LTIM", "KPITTECH", "LTTS", "MPHASIS", "CYIENT", "TATAELXSI", "HFCL"],
            "SENSEX": ["TCS", "NTPC", "ICICIBANK", "ITC", "HINDUNILVR", "BHARTIARTL", "ADANIPORTS", "TECHM", "RELIANCE", "INFY", "NESTLEIND", "SBIN", "ASIANPAINT", "KOTAKBANK", "MARUTI", "HCLTECH", "BAJFINANCE", "TATAMOTORS", "LT", "TITAN", "TATASTEEL", "POWERGRID", "JSWSTEEL", "BAJAJFINSV", "ULTRACEMCO", "INDUSINDBK", "HDFCBANK", "SUNPHARMA", "M&M", "AXISBANK"],
            "METALS": ["ADANIENT", "JINDALSTEL", "SAIL", "TATASTEEL", "JSWSTEEL", "HINDALCO", "HINDCOPPER", "VEDL", "NATIONALUM", "NMDC", "JSL", "APLAPOLLO"],
            "PHARMACEUTICALS": ["AUROPHARMA", "ZYDUSLIFE", "GLENMARK", "DRREDDY", "LAURUSLABS", "CIPLA", "LUPIN", "DIVISLAB", "TORNTPHARM", "GRANULES", "ALKEM", "SUNPHARMA", "BIOCON"],
            "PSU BANKS": ["BANKBARODA", "SBIN", "INDIANB", "BANKINDIA", "UNIONBANK", "PNB", "CANBK"],
            "PRIVATE BANKS": ["ICICIBANK", "KOTAKBANK", "FEDERALBNK", "RBLBANK", "BANDHANBNK", "INDUSINDBK", "HDFCBANK", "IDFCFIRSTB", "AXISBANK"],
            "REALTY": ["NCC", "PHOENIXLTD", "PRESTIGE", "OBEROIRLTY", "GODREJPROP", "DLF", "LODHA", "NBCC", "IRB"],
            "ENERGY": ["NTPC", "COALINDIA", "RELIANCE", "ONGC", "CESE", "SOLARINDS", "TATAPOWER", "TORNTPOWER", "BPCL", "IOC", "ADANIENSOL", "IREDA", "OIL", "POWERGRID", "ATGL", "CGPOWER", "PETRONET", "JSWENERGY", "SJVN", "NHPC", "IGL", "GMRAIRPORT", "ADANIGREEN"],
            "CEMENT": ["AMBUJACEM", "ACC", "JKCEMENT", "ULTRACEMCO", "DALBHARAT", "SHREECEM", "RAMCOCEM"],
            "MIDCAP SELECT": [
                "ABB", "AARTIIND", "ABCAPITAL", "ABFRL", "BSOFT", "BHEL", "CESC", "CHAMBLFERT", "CROMPTON", "DEEPAKNTR", 
                "DELHIVERY", "DIXON", "ETERNAL", "ESCORTS", "GAIL", "HAL", "HAVELLS", "HINDZINC", "IEX", "IRCTC", 
                "INDUSTOWER", "NAUKRI", "INOXWIND", "INDIGO", "KEI", "LTF", "MGL", "M&MFIN", "MANAPPURAM", "MFSL", 
                "MCX", "OFSS", "PNBHOUSING", "PIDILITIND", "PEL", "SRF", "SIEMENS", "SYNGENE", "TATACHEM", 
                "TATACOMM", "TATATECH", "YESBANK", "AUROPHARMA", "HINDUPETRO", "VOLTAS", "UPL", "HDFCAMC", "PERSISTENT", "FEDERALBNK", "POLYCAB", 
                "COFORGE", "LUPIN", "ASTRAL", "PAGEIND", "PIIND", "BHARATFORG", "MRF", "JUBLFOOD", "CONCOR", 
                "INDHOTEL", "GODREJPROP", "AUBANK", "ASHOKLEY", "MPHASIS", "IDFCFIRSTB", "IDEA", "CUMMINSIND"
            ]
        };

        const punchlines = [
            "Catch the Pulse, Ride the Move.",
            "No Noise. Just Precision.",
            "Built for Speed. Designed to Grab Gains.",
            "Strike Fast, Exit Smarter.",
            "From Sector Surge to Pocket Profit ‚Äì Instantly.",
            "Decode Momentum. Dominate the Move.",
            "Fast Picks. Clean Breaks. Real Edge.",
            "Find the Spark Before the Flame.",
            "Scans That Speak the Market's Language.",
            "One Click Ahead of the Herd."
        ];

        const quotes = [
            { text: "Opportunities don't happen, you create them.", author: "" },
            { text: "The market is always right. Never argue with it.", author: "" },
            { text: "Price is what you pay. Value is what you get.", author: "Benjamin Graham" },
            { text: "Risk comes from not knowing what you're doing.", author: "Warren Buffett" },
            { text: "Time is your friend; impulse is your enemy.", author: "" },
            { text: "Buy when everyone else is selling and hold until everyone else is buying.", author: "Warren Buffett" },
            { text: "The stock market is filled with individuals who know the price of everything, but the value of nothing.", author: "" },
            { text: "In investing, what is comfortable is rarely profitable.", author: "" },
            { text: "The four most dangerous words in investing are: 'This time it's different.'", author: "Sir John Templeton" },
            { text: "Wide diversification is only required when investors do not understand what they are doing.", author: "Warren Buffett" },
            { text: "The individual investor should act consistently as an investor and not as a speculator.", author: "Ben Graham" },
            { text: "It's not whether you're right or wrong that's important, but how much money you make when you're right and how much you lose when you're wrong.", author: "George Soros" },
            { text: "The goal of a successful trader is to make the best trades. Money is secondary.", author: "Alexander Elder" },
            { text: "If you can't control your emotions, you can't control your money.", author: "Warren Buffett" },
            { text: "The most important quality for an investor is temperament, not intellect.", author: "Warren Buffett" },
            { text: "Know what you own, and know why you own it.", author: "Peter Lynch" },
            { text: "The stock market is a device for transferring money from the impatient to the patient.", author: "Warren Buffett" },
            { text: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
            { text: "Don't look for the needle in the haystack. Just buy the haystack!", author: "John Bogle" },
            { text: "Someone's sitting in the shade today because someone planted a tree a long time ago.", author: "Warren Buffett" },
            { text: "It's far better to buy a wonderful company at a fair price than a fair company at a wonderful price.", author: "Warren Buffett" },
            { text: "Our favorite holding period is forever.", author: "Warren Buffett" },
            { text: "You get recessions, you have stock market declines. If you don't understand that's going to happen, then you're not ready, you won't do well in the markets.", author: "Peter Lynch" },
            { text: "The stock market is a no-called-strike game. You don't have to swing at everything‚Äîyou can wait for your pitch.", author: "Warren Buffett" },
            { text: "The key to making money in stocks is not to get scared out of them.", author: "Peter Lynch" },
            { text: "The biggest risk of all is not taking one.", author: "" },
            { text: "Compound interest is the eighth wonder of the world. He who understands it, earns it; he who doesn't, pays it.", author: "Albert Einstein" },
            { text: "Do not save what is left after spending, but spend what is left after saving.", author: "Warren Buffett" },
            { text: "Never depend on a single income. Make investment to create a second source.", author: "Warren Buffett" },
            { text: "The best investment you can make is in yourself.", author: "Warren Buffett" }
        ];

        // ===== WATCHLIST FUNCTIONALITY =====
        let watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];

        function addToWatchlist(ticker, sector) {
            if (!watchlist.some(item => item.ticker === ticker)) {
                watchlist.push({ ticker, sector });
                localStorage.setItem('watchlist', JSON.stringify(watchlist));
                updateWatchlistUI();
            }
        }

        function removeFromWatchlist(ticker) {
            watchlist = watchlist.filter(item => item.ticker !== ticker);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            updateWatchlistUI();
        }

        function updateWatchlistUI() {
            const watchlistBody = document.getElementById('watchlistBody');
            watchlistBody.innerHTML = watchlist.map(item => `
                <tr>
                    <td>${item.ticker}</td>
                    <td>${item.sector}</td>
                    <td class="remove-watchlist" onclick="removeFromWatchlist('${item.ticker}')">‚úï</td>
                </tr>
            `).join('');
        }

        // ===== DRAGGABLE WATCHLIST =====
        const watchlistPanel = document.getElementById('watchlistPanel');
        let isDragging = false;
        let offsetX, offsetY;

        watchlistPanel.addEventListener('mousedown', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.classList.contains('remove-watchlist')) return;
            
            isDragging = true;
            offsetX = e.clientX - watchlistPanel.getBoundingClientRect().left;
            offsetY = e.clientY - watchlistPanel.getBoundingClientRect().top;
            watchlistPanel.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            watchlistPanel.style.left = `${e.clientX - offsetX}px`;
            watchlistPanel.style.top = `${e.clientY - offsetY}px`;
            watchlistPanel.style.right = 'unset';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            watchlistPanel.style.cursor = 'grab';
        });

        // Close watchlist button
        document.getElementById('closeWatchlist').addEventListener('click', () => {
            watchlistPanel.style.display = 'none';
            localStorage.setItem('watchlistVisible', 'false');
        });

        // Clear All Functionality
        document.getElementById('clearWatchlist').addEventListener('click', () => {
            watchlist = [];
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            updateWatchlistUI();
        });

        // Ctrl+Shift+Del Shortcut
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'Delete') {
                e.preventDefault();
                document.getElementById('clearWatchlist').click();
            }
        });

        // Toggle Watchlist Visibility (Ctrl+Shift+Z)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'z') {
                e.preventDefault();
                if (watchlistPanel.style.display === 'none') {
                    watchlistPanel.style.display = 'block';
                    localStorage.setItem('watchlistVisible', 'true');
                } else {
                    watchlistPanel.style.display = 'none';
                    localStorage.setItem('watchlistVisible', 'false');
                }
            }
        });


        // Initialize watchlist visibility from localStorage
        const savedVisibility = localStorage.getItem('watchlistVisible');
        if (watchlistPanel) {
            watchlistPanel.style.display = 
                savedVisibility === 'false' ? 'none' : 'block';
        }

        // ===== SEARCH FUNCTIONALITY =====
        const tickerSearch = document.getElementById('tickerSearch');
        const searchResults = document.getElementById('searchResults');
        
        // Focus search when pressing '/'
        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && !e.ctrlKey && !e.shiftKey) {
                e.preventDefault();
                tickerSearch.focus();
            }
        });

        // Handle arrow keys and enter in search results
        let selectedResultIndex = -1;
        
        tickerSearch.addEventListener('input', function(e) {
            const query = e.target.value.trim().toUpperCase();
            
            if (query.length < 2) {
                searchResults.style.display = 'none';
                selectedResultIndex = -1;
                return;
            }

            const results = [];
            Object.entries(sectorData).forEach(([sector, tickers]) => {
                tickers.forEach(ticker => {
                    if (ticker.includes(query)) {
                        results.push({ ticker, sector });
                    }
                });
            });

            if (results.length > 0) {
                searchResults.innerHTML = results.map((item, index) => `
                    <div class="search-result-item ${index === selectedResultIndex ? 'selected' : ''}" 
                         data-index="${index}"
                         onclick="addToWatchlist('${item.ticker}', '${item.sector}')">
                        <strong>${item.ticker}</strong> (${item.sector})
                    </div>
                `).join('');
                searchResults.style.display = 'block';
            } else {
                searchResults.innerHTML = '<div class="search-result-item">No matches found</div>';
                searchResults.style.display = 'block';
            }
        });

        // Handle keyboard navigation in search results
        tickerSearch.addEventListener('keydown', function(e) {
            if (!searchResults.style.display || searchResults.style.display === 'none') return;
            
            const resultItems = searchResults.querySelectorAll('.search-result-item');
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedResultIndex = Math.min(selectedResultIndex + 1, resultItems.length - 1);
                    updateSelectedResult();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    selectedResultIndex = Math.max(selectedResultIndex - 1, -1);
                    updateSelectedResult();
                    break;
                case 'Enter':
                    e.preventDefault();
                    if (selectedResultIndex >= 0 && selectedResultIndex < resultItems.length) {
                        const item = resultItems[selectedResultIndex];
                        const ticker = item.querySelector('strong').textContent;
                        const sector = item.textContent.match(/\((.*?)\)/)[1];
                        addToWatchlist(ticker, sector);
                        tickerSearch.value = '';
                        searchResults.style.display = 'none';
                        selectedResultIndex = -1;
                    }
                    break;
            }
        });

        function updateSelectedResult() {
            const resultItems = searchResults.querySelectorAll('.search-result-item');
            resultItems.forEach((item, index) => {
                if (index === selectedResultIndex) {
                    item.classList.add('selected');
                    item.scrollIntoView({ block: 'nearest' });
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // Close search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                searchResults.style.display = 'none';
                selectedResultIndex = -1;
            }
        });

        // ===== SCAN MODE TOGGLE =====
        let scanModeActive = false;
        let tradingViewWindow = null;
        const scanModeToggle = document.getElementById('scanModeToggle');

        // Toggle function
        function toggleScanMode() {
            scanModeActive = !scanModeActive;
            scanModeToggle.classList.toggle('active', scanModeActive);
            localStorage.setItem('scanModeActive', scanModeActive);
        }

        // Keyboard shortcut (Ctrl+Shift+S)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 's') {
                e.preventDefault(); // Prevent browser save dialog
                toggleScanMode();
            }
        });

        // Initialize from localStorage
        if (localStorage.getItem('scanModeActive') === 'true') {
            scanModeActive = true;
            scanModeToggle.classList.add('active');
        }

        // Click handler
        scanModeToggle.addEventListener('click', toggleScanMode);

        // Function to open TradingView window
        let scanModePopup = null; // Stores the hover popup window

function openTradingViewWindow(ticker, isHover = false) {
  if (!ticker) return;

  // HOVER BEHAVIOR (Scan Mode ON)
  if (isHover && scanModeActive) {
    const url = `https://www.tradingview.com/chart/?symbol=NSE:${ticker}`;
    
    if (scanModePopup && !scanModePopup.closed) {
      // Update existing popup
      scanModePopup.location.href = url;
      scanModePopup.focus();
    } else {
      // Open new popup (600x500)
      scanModePopup = window.open(
        url,
        "ScanModePopup",
        "width=600,height=500,left=100,top=100"
      );
    }
  } 
  // CLICK BEHAVIOR (Always opens new tab)
  else {
    window.open(`https://www.tradingview.com/chart/?symbol=NSE:${ticker}`, "_blank");
  }
}

        // ===== EXPORT FUNCTIONALITY =====
        function exportTradeData(format) {
            // 1. Collect all trade data
            const data = {
                timestamp: new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'}),
                tradeType: document.getElementById('tradeType').value.replace(/_/g, ' ').toUpperCase(),
                entryReason: document.getElementById('entryReason').value,
                exitReason: document.getElementById('exitReason').value,
                lessonsLearned: document.getElementById('lessonsLearned').value,
                trades: [],
                brokerage: document.getElementById('brokerageResult').textContent,
                netResult: document.getElementById('netResult').textContent
            };

            // 2. Only export entered trades
            const tradeCount = parseInt(document.getElementById('tradeMultiplier').value);
            for (let i = 0; i < tradeCount; i++) {
                const buyPrice = document.getElementById(`buyPrice${i}`).value;
                if (buyPrice) {
                    data.trades.push({
  number: i + 1,
  ticker: document.getElementById(`ticker${i}`).value || "N/A",
  buyPrice: document.getElementById(`buyPrice${i}`).value || "N/A",
  sellPrice: document.getElementById(`sellPrice${i}`).value || "N/A",
  quantity: document.getElementById(`quantity${i}`).value || "N/A",
});
                }
            }

            // 3. Format-specific export
            switch(format) {
                case 'text': exportAsText(data); break;
                case 'pdf': exportAsPDF(data); break;
                case 'excel': exportAsExcel(data); break;
            }
        }

        // Text Export
        function exportAsText(data) {
  const punchline = punchlines[Math.floor(Math.random() * punchlines.length)];
  const quote = quotes[Math.floor(Math.random() * quotes.length)];

  let text = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n`;
  text += `‚ïë      Intraday Quick Grabber       ‚ïë\n`;
  text += `‚ïë  "${punchline}"  ‚ïë\n`;
  text += `‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n`;
  
  // Table
  text += `‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n`;
  text += `‚îÇ  #  ‚îÇ    Scrip     ‚îÇ  Buy(‚Çπ)  ‚îÇ Sell(‚Çπ)  ‚îÇ  Qty   ‚îÇ\n`;
  text += `‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n`;
  
  data.trades.forEach(trade => {
    text += `‚îÇ ${trade.number.toString().padEnd(3)} ‚îÇ ${(trade.ticker || "N/A").padEnd(12)} ‚îÇ `;
    text += `${(trade.buyPrice ? "‚Çπ"+trade.buyPrice : "N/A").padEnd(8)} ‚îÇ `;
    text += `${(trade.sellPrice ? "‚Çπ"+trade.sellPrice : "N/A").padEnd(8)} ‚îÇ `;
    text += `${(trade.quantity || "N/A").padEnd(6)} ‚îÇ\n`;
  });
  
  text += `‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n`;
  text += `üí¨ "${quote.text}"\n`;
  text += `   ‚Äî ${quote.author || "Unknown"}\n\n`;
  text += `Generated by Intraday Quick Grabber | Built for precision trading üß†‚ö°`;

  // Download
  const blob = new Blob([text], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `TradeReport_${new Date().toISOString().slice(0,10)}.txt`;
  a.click();
}

        // PDF Export
        function exportAsPDF(data) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Title (Same as website)
  doc.setFont("Quenton", "normal");
  doc.setFontSize(24);
  doc.setTextColor(67, 97, 238); // --accent color
  doc.text("Intraday Quick Grabber", 105, 20, { align: "center" });

  // Random punchline
  const punchline = punchlines[Math.floor(Math.random() * punchlines.length)];
  doc.setFont("Segoe UI", "normal");
  doc.setFontSize(12);
  doc.setTextColor(100);
  doc.text(punchline, 105, 30, { align: "center" });

  // Trade Table (Styled)
  doc.autoTable({
    head: [["#", "Scrip", "Buy (‚Çπ)", "Sell (‚Çπ)", "Qty"]],
    body: data.trades.map(trade => [
      trade.number,
      trade.ticker || "N/A",
      trade.buyPrice ? "‚Çπ" + trade.buyPrice : "N/A",
      trade.sellPrice ? "‚Çπ" + trade.sellPrice : "N/A",
      trade.quantity || "N/A"
    ]),
    headStyles: {
      fillColor: [67, 97, 238], // --accent
      textColor: [255, 255, 255],
      fontStyle: "bold"
    },
    startY: 40
  });

  // Footer with random quote
  const quote = quotes[Math.floor(Math.random() * quotes.length)];
  doc.setFontSize(10);
  doc.text(`"${quote.text}" - ${quote.author || "Unknown"}`, 15, doc.lastAutoTable.finalY + 20);
  doc.text("Generated by Intraday Quick Grabber | Built for precision trading üß†‚ö°", 105, doc.lastAutoTable.finalY + 30, { align: "center" });

  doc.save(`TradeReport_${new Date().toISOString().slice(0,10)}.pdf`);
}

        // Excel Export
        function exportAsExcel(data) {
  // Get current date/time in Indian format
  const now = new Date();
  const options = { 
    timeZone: 'Asia/Kolkata',
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  };
  const timestamp = now.toLocaleString('en-IN', options);
  
  // Prepare data with your exact requested format
  const wsData = [
    ["Intraday Quick Grabber", "", "", "", ""],
    ["Generated:", timestamp, "", "", ""],
    ["", "", "", "", ""], // Empty row
    ["#", "Scrip", "Buy (‚Çπ)", "Sell (‚Çπ)", "Quantity"],
    ...data.trades.map(trade => [
      trade.number,
      trade.ticker || "N/A",
      trade.buyPrice || "N/A",
      trade.sellPrice || "N/A",
      trade.quantity || "N/A"
    ]),
    ["", "", "", "", ""], // Empty row
    ["Generated by Intraday Quick Grabber | Built for precision trading üß†‚ö°", "", "", "", ""]
  ];

  // Create worksheet with column widths
  const ws = XLSX.utils.aoa_to_sheet(wsData);
  ws['!cols'] = [
    {wch: 5},  // #
    {wch: 15}, // Scrip
    {wch: 10}, // Buy
    {wch: 10}, // Sell
    {wch: 8}   // Qty
  ];

  // Merge title and footer cells
  ws['!merges'] = [
    {s: {r: 0, c: 0}, e: {r: 0, c: 4}}, // Title
    {s: {r: 1, c: 1}, e: {r: 1, c: 4}}, // Timestamp
    {s: {r: wsData.length-1, c: 0}, e: {r: wsData.length-1, c: 4}} // Footer
  ];

  // Create workbook and save
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Trades");
  XLSX.writeFile(wb, `TradeReport_${now.toISOString().slice(0,10)}.xlsx`);
}

// ===== TICKER AUTOCOMPLETE =====
function setupTickerAutocomplete() {
  // Get all unique tickers
  const allTickers = [...new Set(Object.values(sectorData).flat())];
  
  // Apply to all calculator ticker inputs
  document.querySelectorAll('.ticker-autocomplete').forEach(input => {
    // Create dropdown container
    const container = input.parentNode;
    container.style.position = 'relative'; // Required for dropdown positioning
    
    const dropdown = document.createElement('div');
    dropdown.className = 'autocomplete-dropdown';
    container.appendChild(dropdown);

    // Show suggestions on input
    input.addEventListener('input', function() {
      const query = this.value.trim().toUpperCase();
      dropdown.innerHTML = '';
      
      if (query.length >= 1) {
        const matches = allTickers
          .filter(ticker => ticker.includes(query))
          .slice(0, 5);
        
        if (matches.length > 0) {
          matches.forEach(ticker => {
            const item = document.createElement('div');
            item.className = 'autocomplete-item';
            item.textContent = ticker;
            item.addEventListener('click', () => {
              input.value = ticker;
              dropdown.style.display = 'none';
            });
            dropdown.appendChild(item);
          });
          dropdown.style.display = 'block';
        } else {
          dropdown.style.display = 'none';
        }
      } else {
        dropdown.style.display = 'none';
      }
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (!container.contains(e.target)) {
        dropdown.style.display = 'none';
      }
    });
  });
}


function getTradeData() {
    const tradeCount = document.getElementById('tradeMultiplier').value;
    const data = {
        timestamp: new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'}),
        tradeType: document.getElementById('tradeType').value,
        trades: [],
        entryReason: document.getElementById('entryReason').value,
        exitReason: document.getElementById('exitReason').value,
        lessonsLearned: document.getElementById('lessonsLearned').value
    };

    for (let i = 0; i < tradeCount; i++) {
        data.trades.push({
            number: i + 1,
            ticker: document.getElementById(`ticker${i}`).value,
            buyPrice: document.getElementById(`buyPrice${i}`).value,
            sellPrice: document.getElementById(`sellPrice${i}`).value,
            quantity: document.getElementById(`quantity${i}`).value
        });
    }
    return data;
}

// ===== MINIMAL NAV TOGGLE =====
function switchPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.minimal-nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`${pageId}-page`).classList.add('active');
  document.querySelector(`.minimal-nav-btn[data-page="${pageId}"]`).classList.add('active');
}
document.querySelectorAll('.minimal-nav-btn').forEach(btn => {
  btn.addEventListener('click', () => switchPage(btn.dataset.page));
});


                // ===== INITIALIZE PAGE =====
        document.addEventListener('DOMContentLoaded', function() {
            initThemeToggle();
            initDateTime();
            initTagline();
            initSectorGrid();
            initQuotes();
            initCalculator();
            initTradeMultiplier();
            initCollapsibleSections();
            initRandomTicker();
            updateWatchlistUI();
            setupHoverToChart();
            initCharCounters();
            
            // Ensure sector grid is visible
            document.getElementById('sectorGrid').style.display = 'grid';
        });

        // ===== THEME TOGGLE =====
        function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            function setTheme(isDark) {
                if (isDark) {
                    document.body.classList.remove('light-mode');
                    themeIcon.textContent = 'üåô';
                    themeText.textContent = 'Dark Mode';
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.add('light-mode');
                    themeIcon.textContent = '‚òÄÔ∏è';
                    themeText.textContent = 'Light Mode';
                    localStorage.setItem('theme', 'light');
                }
            }
            
            themeToggle.addEventListener('click', () => {
                const isDark = !document.body.classList.contains('light-mode');
                setTheme(!isDark);
            });
            
            if (localStorage.getItem('theme') === 'light') {
                setTheme(false);
            }
        }

        // ===== DATE/TIME FUNCTIONS =====
        function initDateTime() {
            function updateDateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    timeZone: 'Asia/Kolkata'
                };
                
                document.getElementById('current-date').textContent = now.toLocaleDateString('en-IN', options);
                
                const timeOptions = {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true,
                    timeZone: 'Asia/Kolkata'
                };
                document.getElementById('current-time').textContent = now.toLocaleTimeString('en-IN', timeOptions);
                
                const lastDayOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                const daysInMonth = lastDayOfMonth.getDate();
                const daysLeftMonth = daysInMonth - now.getDate();
                document.getElementById('days-month').textContent = `${daysLeftMonth} days`;
                
                const lastDayOfYear = new Date(now.getFullYear(), 11, 31);
                const daysLeftYear = Math.ceil((lastDayOfYear - now) / (1000 * 60 * 60 * 24));
                document.getElementById('days-year').textContent = `${daysLeftYear} days`;
            }
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
        }

        // ===== TAGLINE =====
        function initTagline() {
            const taglineElement = document.getElementById('tagline');
            const randomPunchline = punchlines[Math.floor(Math.random() * punchlines.length)];
            taglineElement.textContent = randomPunchline;
        }

        // ===== SECTOR GRID =====
        function initSectorGrid() {
            const sectorGrid = document.getElementById('sectorGrid');
            
            Object.entries(sectorData).forEach(([sectorName, stocks]) => {
                const sectorDiv = document.createElement('div');
                sectorDiv.className = 'sector-table';
                sectorDiv.innerHTML = `
                    <div class="sector-header">
                        <span class="sector-number">${Object.keys(sectorData).indexOf(sectorName) + 1}.</span> 
                        ${sectorName}
                    </div>
                    <div class="stock-list" id="${sectorName}-stocks"></div>
                `;
                
                const stockList = sectorDiv.querySelector('.stock-list');
                const isMidcap = sectorName === "MIDCAP SELECT";
                const itemsPerPage = isMidcap ? 15 : 10; // Show 15 for MIDCAP, 10 for others
                
                // Create mini pagination container
                const miniPagination = document.createElement('div');
                miniPagination.className = 'mini-pagination';
                
                const miniPaginationContainer = document.createElement('div');
                miniPaginationContainer.className = 'mini-pagination-container';
                
                const currentPageIndicator = document.createElement('div');
                currentPageIndicator.className = 'current-page-indicator';
                currentPageIndicator.textContent = '1';
                currentPageIndicator.addEventListener('click', function(e) {
                    e.stopPropagation();
                    miniPagination.style.maxHeight = miniPagination.style.maxHeight === '200px' ? '24px' : '200px';
                });
                
                miniPagination.appendChild(currentPageIndicator);
                miniPagination.appendChild(miniPaginationContainer);
                
                const pageCount = Math.ceil(stocks.length / itemsPerPage);
                for (let i = 0; i < pageCount; i++) {
                    const pageDiv = document.createElement('div');
                    pageDiv.className = `stock-page ${i === 0 ? 'active' : ''}`;
                    pageDiv.dataset.page = i + 1;
                    
                    const startIdx = i * itemsPerPage;
                    const endIdx = startIdx + itemsPerPage;
                    const pageStocks = stocks.slice(startIdx, endIdx);
                    
                    for (let j = 0; j < itemsPerPage; j++) {
                        const stockItem = document.createElement('div');
                        stockItem.className = 'stock-item';
                        
                        if (j < pageStocks.length) {
                            stockItem.textContent = pageStocks[j];
                            stockItem.addEventListener('click', (e) => {
                                if (e.ctrlKey) { // Hold CTRL to add to watchlist
                                    addToWatchlist(pageStocks[j], sectorName);
                                } else {
                                    openTradingViewWindow(pageStocks[j]);
                                }
                            });
                        } else {
                            stockItem.style.visibility = 'hidden';
                        }
                        
                        pageDiv.appendChild(stockItem);
                    }
                    
                    stockList.appendChild(pageDiv);
                    
                    if (pageCount > 1) {
                        const pageBtn = document.createElement('button');
                        pageBtn.className = `mini-page-btn ${i === 0 ? 'active' : ''}`;
                        pageBtn.textContent = i + 1;
                        pageBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            stockList.querySelectorAll('.stock-page').forEach(page => {
                                page.classList.remove('active');
                            });
                            pageDiv.classList.add('active');
                            
                            miniPaginationContainer.querySelectorAll('.mini-page-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            pageBtn.classList.add('active');
                            currentPageIndicator.textContent = i + 1;
                            miniPagination.style.maxHeight = '24px';
                        });
                        miniPaginationContainer.appendChild(pageBtn);
                    }
                }
                
                if (pageCount > 1) {
                    sectorDiv.appendChild(miniPagination);
                }
                
                sectorGrid.appendChild(sectorDiv);
            });
        }

        // ===== QUOTES =====
        function initQuotes() {
            const quoteText = document.getElementById('quoteText');
            const quoteAuthor = document.getElementById('quoteAuthor');
            
            function showRandomQuote() {
                const quote = quotes[Math.floor(Math.random() * quotes.length)];
                quoteText.textContent = `"${quote.text}"`;
                quoteAuthor.textContent = quote.author ? `- ${quote.author}` : '';
            }
            
            showRandomQuote();
            setInterval(showRandomQuote, 10000);
        }
        
        // ===== TRADE MULTIPLIER =====
function initTradeMultiplier() {
    const tradeMultiplier = document.getElementById('tradeMultiplier');
    const tradesTableBody = document.getElementById('tradesTableBody');
    
    function generateTradeRows(count) {
        tradesTableBody.innerHTML = '';
        
        for (let i = 0; i < count; i++) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${i + 1}</td>
                <td>
                    <input type="text" class="trade-input ticker-autocomplete" 
                           id="ticker${i}" placeholder="e.g. RELIANCE" 
                           autocomplete="off">
                </td>
                <td><input type="number" class="trade-input" id="buyPrice${i}" placeholder="0.00"></td>
                <td><input type="number" class="trade-input" id="sellPrice${i}" placeholder="0.00"></td>
                <td><input type="number" class="trade-input" id="quantity${i}" placeholder="0"></td>
                <td>
  <div style="position: relative">
    <input type="text" class="trade-input ticker-autocomplete" 
           id="ticker0" placeholder="e.g. RELIANCE" autocomplete="off">
  </div>
</td>
            `;
            tradesTableBody.appendChild(row);
        }
        
        // 4TH STEP: ACTIVATE AUTOCOMPLETE FOR NEW ROWS
        setupTickerAutocomplete();
    }
    
    // Initialize with single trade
    generateTradeRows(1);
    
    // Update when multiplier changes
    tradeMultiplier.addEventListener('change', function() {
        generateTradeRows(parseInt(this.value));
    });
}


function exportExcelWithData() {
  // 1. Collect all trade data (same way your PDF export does)
  const data = {
    timestamp: new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'}),
    trades: []
  };

  // 2. Get all trades from the table
  const tradeCount = document.getElementById('tradeMultiplier').value;
  for (let i = 0; i < tradeCount; i++) {
    data.trades.push({
      number: i + 1,
      ticker: document.getElementById(`ticker${i}`).value,
      buyPrice: document.getElementById(`buyPrice${i}`).value,
      sellPrice: document.getElementById(`sellPrice${i}`).value,
      quantity: document.getElementById(`quantity${i}`).value
    });
  }

  // 3. Call the fixed Excel export
  exportAsExcel(data);
}
        // ===== COLLAPSIBLE SECTIONS =====
        function initCollapsibleSections() {
            const sections = document.querySelectorAll('.calculator-section');
            
            sections.forEach(section => {
                const title = section.querySelector('.calculator-section-title');
                const content = section.querySelector('.calculator-section-content');
                
                // Set initial height
                if (content.classList.contains('collapsed')) {
                    content.style.maxHeight = '0';
                } else {
                    content.style.maxHeight = content.scrollHeight + 'px';
                }
                
                title.addEventListener('click', function() {
                    this.classList.toggle('collapsed');
                    content.classList.toggle('collapsed');
                    
                    if (content.classList.contains('collapsed')) {
                        content.style.maxHeight = '0';
                    } else {
                        content.style.maxHeight = content.scrollHeight + 'px';
                    }
                });
            });
            
            // Toggle detailed results
            const toggleDetails = document.getElementById('toggleDetails');
            const detailedResults = document.getElementById('detailedResults');
            
            toggleDetails.addEventListener('click', function() {
                if (detailedResults.style.display === 'none') {
                    detailedResults.style.display = 'block';
                    this.textContent = 'Hide Detailed Breakdown ‚ñ≤';
                } else {
                    detailedResults.style.display = 'none';
                    this.textContent = 'Show Detailed Breakdown ‚ñº';
                }
            });
        }
        
        // ===== ENHANCED TRADING CALCULATOR =====
        function initCalculator() {
            const calculateButton = document.getElementById('calculateButton');
            calculateButton.addEventListener('click', calculateAllTrades);
            
            function calculateAllTrades() {
                const tradeType = document.getElementById('tradeType').value;
                const tradeCount = parseInt(document.getElementById('tradeMultiplier').value);
                
                let totalGrossPL = 0;
                let totalBrokerage = 0;
                let totalStt = 0;
                let totalTransactionCharges = 0;
                let totalGst = 0;
                let totalSebiCharges = 0;
                let totalStampDuty = 0;
                
                // Calculate each trade
                for (let i = 0; i < tradeCount; i++) {
                    const buyPrice = parseFloat(document.getElementById(`buyPrice${i}`).value) || 0;
                    const sellPrice = parseFloat(document.getElementById(`sellPrice${i}`).value) || 0;
                    const quantity = parseInt(document.getElementById(`quantity${i}`).value) || 0;
                    
                    // Calculate turnover
                    const buyValue = buyPrice * quantity;
                    const sellValue = sellPrice * quantity;
                    const turnover = buyValue + sellValue;
                    
                    // Calculate gross profit/loss
                    let grossPL = (sellValue - buyValue);
                    totalGrossPL += grossPL;
                    
                    // Initialize charges
                    let brokerage = 0;
                    let stt = 0;
                    let transactionCharges = 0;
                    let gst = 0;
                    let sebiCharges = 0;
                    let stampDuty = 0;
                    
                    // Calculate brokerage based on trade type
                    switch(tradeType) {
                        case 'equity_delivery':
                            brokerage = 0; // Zero brokerage
                            stt = sellValue * 0.001; // 0.1% on sell side
                            transactionCharges = buyValue * 0.0000297 + sellValue * 0.0000297; // NSE charges
                            stampDuty = buyValue * 0.00015; // 0.015% on buy side
                            break;
                        case 'equity_intraday':
                            // Brokerage is 0.03% or ‚Çπ20 per order (whichever is lower)
                            const brokerageRate = 0.0003;
                            brokerage = Math.min(buyValue * brokerageRate, 20) + Math.min(sellValue * brokerageRate, 20);
                            stt = sellValue * 0.00025; // 0.025% on sell side
                            transactionCharges = buyValue * 0.0000297 + sellValue * 0.0000297; // NSE charges
                            stampDuty = buyValue * 0.00003; // 0.003% on buy side
                            break;
                        case 'futures':
                            // Brokerage is 0.03% or ‚Çπ20 per order (whichever is lower)
                            const futuresBrokerageRate = 0.0003;
                            brokerage = Math.min(buyValue * futuresBrokerageRate, 20) + Math.min(sellValue * futuresBrokerageRate, 20);
                            stt = sellValue * 0.0002; // 0.02% on sell side
                            transactionCharges = buyValue * 0.0000173 + sellValue * 0.0000173; // NSE futures charges
                            stampDuty = buyValue * 0.00003; // 0.003% on buy side
                            break;
                        case 'options':
                            // Flat ‚Çπ20 per order
                            brokerage = 20 * 2; // Buy and sell
                            stt = sellValue * 0.001; // 0.1% on sell side (on premium)
                            transactionCharges = (buyPrice + sellPrice) * quantity * 0.0003503; // NSE options charges on premium
                            stampDuty = buyValue * 0.00003; // 0.003% on buy side
                            break;
                    }
                    
                    // Calculate other charges
                    sebiCharges = turnover * 0.000001; // ‚Çπ10 per crore
                    const totalBeforeGST = brokerage + transactionCharges + sebiCharges;
                    gst = totalBeforeGST * 0.18; // 18% GST
                    
                    // Add to totals
                    totalBrokerage += brokerage;
                    totalStt += stt;
                    totalTransactionCharges += transactionCharges;
                    totalGst += gst;
                    totalSebiCharges += sebiCharges;
                    totalStampDuty += stampDuty;
                }
                
                // Calculate net profit/loss
                const totalCharges = totalBrokerage + totalStt + totalTransactionCharges + totalGst + totalSebiCharges + totalStampDuty;
                const totalNetPL = totalGrossPL - totalCharges;
                
                // Display results
                document.getElementById('grossResult').textContent = `‚Çπ${totalGrossPL.toFixed(2)}`;
                document.getElementById('brokerageResult').textContent = `‚Çπ${totalBrokerage.toFixed(2)}`;
                document.getElementById('sttResult').textContent = `‚Çπ${totalStt.toFixed(2)}`;
                document.getElementById('transactionResult').textContent = `‚Çπ${totalTransactionCharges.toFixed(2)}`;
                document.getElementById('gstResult').textContent = `‚Çπ${totalGst.toFixed(2)}`;
                document.getElementById('sebiResult').textContent = `‚Çπ${totalSebiCharges.toFixed(2)}`;
                document.getElementById('stampResult').textContent = `‚Çπ${totalStampDuty.toFixed(2)}`;
                document.getElementById('netResult').textContent = `‚Çπ${totalNetPL.toFixed(2)}`;
                
                // Color net result based on profit/loss
                const netResultElement = document.getElementById('netResult');
                if (totalNetPL >= 0) {
                    netResultElement.className = 'profit';
                } else {
                    netResultElement.className = 'loss';
                }
                
                // Show results
                document.getElementById('calculatorResults').style.display = 'block';
                document.getElementById('detailedResults').style.display = 'none';
                document.getElementById('toggleDetails').textContent = 'Show Detailed Breakdown ‚ñº';
            }
        }

         // ===== RANDOM TICKER BOX =====
function initRandomTicker() {
    // 1. Get DOM element with error handling
    const tickerBox = document.getElementById('randomTicker');
    if (!tickerBox) {
        console.error("Error: #randomTicker element not found");
        return;
    }

    // 2. Verify sectorData exists and has stocks
    if (!sectorData || Object.keys(sectorData).length === 0) {
        console.error("Error: sectorData is empty");
        return;
    }

    // 3. Get all unique stocks
    const allStocks = [...new Set(Object.values(sectorData).flat())];
    console.log("Total stocks available:", allStocks.length);

    // 4. Clear any existing interval
    if (window.tickerInterval) {
        clearInterval(window.tickerInterval);
        window.tickerInterval = null;
    }

    // 5. Update function with forced DOM refresh
    const updateTicker = () => {
        const randomStock = allStocks[Math.floor(Math.random() * allStocks.length)];
        
        // FORCE DOM UPDATE (critical fix)
        tickerBox.style.opacity = '0';
        setTimeout(() => {
            tickerBox.textContent = randomStock;
            tickerBox.dataset.ticker = randomStock;
            tickerBox.style.opacity = '1';
        }, 50);
        
        console.log("Updated UI to:", randomStock, new Date().toLocaleTimeString());
    };

    // 6. Initialize immediately
    updateTicker();
    
    // 7. Start updates (using recursive timeout for reliability)
    const startUpdateCycle = () => {
        updateTicker();
        window.tickerInterval = setTimeout(startUpdateCycle, 12000);
    };
    window.tickerInterval = setTimeout(startUpdateCycle, 12000);
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', initRandomTicker);



        // ===== HOVER TO CHART FUNCTIONALITY =====
        function setupHoverToChart() {
  // Remove all old event listeners first (critical fix)
  document.querySelectorAll(".stock-item, #watchlistBody tr, .random-ticker-value").forEach(el => {
    el.replaceWith(el.cloneNode(true)); // This wipes all old event listeners
  });

  // For sector stocks
  document.querySelectorAll(".stock-item").forEach(item => {
    const ticker = item.textContent.trim();

    // Hover behavior (Scan Mode only)
    item.addEventListener("mouseenter", () => {
      if (scanModeActive && ticker) {
        openTradingViewWindow(ticker, true);
      }
    });

    // Click behavior (single tab)
    item.addEventListener("click", e => {
      if (ticker && !e.ctrlKey) {
        e.stopImmediatePropagation(); // Block all other click handlers
        window.open(`https://www.tradingview.com/chart/?symbol=NSE:${ticker}`, "TradingViewTab");
      }
    }, { once: true }); // Ensures listener only fires once
  });

  // For watchlist items
  document.querySelectorAll("#watchlistBody tr").forEach(row => {
    const ticker = row.querySelector("td:first-child")?.textContent.trim();
    if (!ticker) return;

    row.addEventListener("click", e => {
      if (!e.target.classList.contains("remove-watchlist")) {
        e.stopImmediatePropagation();
        window.open(`https://www.tradingview.com/chart/?symbol=NSE:${ticker}`, "TradingViewTab");
      }
    }, { once: true });
  });

  // For random ticker box
  const randomTicker = document.getElementById("randomTicker");
  randomTicker.addEventListener("click", e => {
    e.stopImmediatePropagation();
    window.open(`https://www.tradingview.com/chart/?symbol=NSE:${randomTicker.textContent}`, "TradingViewTab");
  }, { once: true });
}

        // ===== CHARACTER COUNTERS =====
        function initCharCounters() {
            // Setup for entry reason
            document.getElementById('entryReason').addEventListener('input', function() {
                document.getElementById('entryChars').textContent = this.value.length;
            });
            
            // Setup for exit reason
            document.getElementById('exitReason').addEventListener('input', function() {
                document.getElementById('exitChars').textContent = this.value.length;
            });
            
            // Setup for lessons learned
            document.getElementById('lessonsLearned').addEventListener('input', function() {
                document.getElementById('lessonsChars').textContent = this.value.length;
            });
        }
    </script>
</body>
</html>
